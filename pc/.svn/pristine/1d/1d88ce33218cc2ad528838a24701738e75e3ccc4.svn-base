<style lang="less" scoped>
  .tuiTion{
      .top{
          width: 928px;
          height:48px ;
          background-color: #fff;
          border-radius: 5px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0 28px 0 22px;
          span{
              font-size: 16px;
              color:#319863 ;
          }
          .edit{
              width: 25px;
              height: 25px;
          }
      }
      .section {
          width: 977px;
          color: #333;
          input{
              border-bottom: 1px solid #999;
              /*padding-left: 6px;*/
              width: 50px;
              text-align: center;
          }
          .grade-set {
              background-color: #fff;
              height: 180px;
              padding: 0 22px;
              margin-top: 12px;
              border-radius: 5px;
              .sec-top {
                  height: 49px;
                  display: flex;
                  align-items: center;
                  border-bottom: 1px dashed #999;
                  position: relative;
                  span {
                      color: #319863;
                      font-weight: 500;
                      margin-right: 8px;
                  }
                  .hint:hover {
                      display: inline-block;
                      height: 16px;
                      width: 16px;
                      background-image: url(../../../images/common-icon/allnotes_hover.png);
                      background-repeat: no-repeat;
                      background-size: 100% 100%;
                      cursor: pointer;
                      .hint-mess {
                          display: block;
                      }
                  }
                  .hint-mess{
                      /*width: 275px;*/
                      /*height:63px;*/
                      display: none;
                      border-radius: 5px;
                      background-color: #31c27c;
                      padding: 11px 16px;
                      color: #fff;
                      position: absolute;
                      top:-38px;
                      left: 87px;
                      span{
                          display: block;
                          width: 0;
                          height: 0;
                          border: 6px solid #31c27c;
                          position: absolute;
                          bottom: -12px;
                          left: 19px;
                          border-right: 6px solid #fff;
                          border-bottom: 6px solid #fff;
                          border-left: 6px solid #fff;
                      }
                  }
              }
              .class-sel{
                  display: flex;
                  flex-wrap: wrap;
                  margin-top: 24px;
                  p{
                      margin-bottom: 24px;
                  }
                  p:nth-of-type(1){
                      width: 490px;
                      span:nth-of-type(1){
                          display: inline-block;
                          width: 109px;
                      }
                      span:nth-of-type(2){
                          margin-right: 39px;
                      }
                  }
                  p:nth-of-type(2){
                      span:nth-of-type(1){
                          display: inline-block;
                          width: 109px;
                      }
                      span:nth-of-type(2){
                          margin-right: 39px;
                      }
                  }
                  .di{
                      span:nth-of-type(1){
                          position: relative;
                      }
                      .ico-h{
                          display: inline-block;
                          background-image: url(../../../images/common-icon/hint.png);
                          width: 16px;
                          height: 16px;
                          background-repeat: no-repeat;
                          background-size: 100% 100%;
                          position: absolute;
                          right: -18px;
                          bottom: 1px;
                          cursor: pointer;
                          &:hover {
                              display: inline-block;
                              height: 16px;
                              width: 16px;
                              background-image: url(../../../images/common-icon/allnotes_hover.png);
                              background-repeat: no-repeat;
                              background-size: 100% 100%;
                              cursor: pointer;
                              .hint-me {
                                  display: block;
                              }
                          }
                        .hint-me{
                            width: 240px;
                            display: none;
                            border-radius: 5px;
                            background-color: #31c27c;
                            padding: 11px 13px;
                            color: #fff;
                            position: absolute;
                            top:-73px;
                            left: -17px;
                            span{
                                display: block;
                                width: 0;
                                height: 0;
                                border: 6px solid #31c27c;
                                position: absolute;
                                bottom: -12px;
                                left: 19px;
                                border-right: 6px solid #fff;
                                border-bottom: 6px solid #fff;
                                border-left: 6px solid #fff;
                            }
                        }
                      }
                      span:nth-of-type(2){
                          margin-left: 35px;
                          margin-right: 39px;
                      }
                  }
              }
          }
          .detain-class{
              .secon{
                  margin-top: 24px;
                  span{
                      margin-bottom: 24px;
                      input{
                          border-bottom: 1px solid #999;
                          /*padding-left: 6px;*/
                          width: 50px;
                          text-align: center;
                      }
                  }
                  span:nth-of-type(1),
                  span:nth-of-type(3){
                      display: inline-block;
                      width: 462px;
                  }
              }
          }
          .urgeQuit{
              .cl-input{
                  display: flex;
                  flex-wrap: wrap;
                  margin-top: 24px;
                  p:nth-of-type(1){
                      width: 462px;
                  }
                  p{
                      margin-bottom: 24px;
                  }
              }
          }
          .make-section{
              .maskSec{
                  margin-top: 24px;
                  p{
                      margin-bottom: 24px;
                  }
                  p:last-child{
                      span:nth-of-type(2){
                          margin-left:33px ;
                          margin-right: 33px;
                      }
                  }
              }
          }
          .vipNorm{
              .normList{
                  margin-top: 24px;
                  p{
                      margin-bottom: 24px;
                      span:nth-of-type(2){
                          margin-left: 22px;
                          margin-right: 22px;
                      }
                      span:nth-of-type(1){
                          display: inline-block;
                          width: 194px;
                      }
                  }
              }
          }
          .vip-count{
              height: 140px;
              .vipCon{
                  margin-top:27px;
                  span{
                      margin-right: 38px;
                  }
              }
          }
          .vip-urge{
              .urgeSec{
                  margin-top: 24px;
                  p{
                      margin-bottom: 24px;
                  }
              }
          }
          .vip-return{
              .sec-rec{
                  margin-top: 24px;
                  p{
                      margin-bottom: 24px;
                  }
              }
          }
          .listen-text{
              .lisTen{
                  margin-top: 24px;
                  p:nth-of-type(1){
                      margin-bottom: 24px;
                      span:nth-of-type(2){
                          margin-left: 39px;
                          margin-right: 39px;
                      }
                  }
                  p:nth-of-type(2){
                      color: #999;
                  }
              }
          }
          .fee_deduction{
              height: 143px;
              p{
                  margin-top: 37px;
                  span:nth-of-type(1){
                      margin-right: 39px;
                  }
              }
          }
          .upgrade{
              p{
                  margin-top: 24px;
              }
          }
          .sub-bt{
              width: 100%;
              height: 46px;
              background-color: #fff;
              border-radius: 5px;
              margin-top: 12px;
              display: flex;
              justify-content: center;
              align-items: center;
          }
      }
  }
</style>
<template>
    <div class="tuiTion">
        <div class="top">
            <span>学费规则</span>
            <i class="edit ico-init ico-edit" @click="editX = !editX"></i>
        </div>
        <div class="section">
            <div class="grade-set">
                <div class="sec-top">
                    <span>班级 · 缴费设置</span>
                    <i class="hint ico-hint">
                        <div class="hint-mess">
                            <p>家长端只支持全额缴费，不收取定金</p>
                            <span></span>
                        </div>
                    </i>
                </div>
                <div class="class-sel">
                    <p>
                        <span>
                            教师端优惠
                        </span>
                        <span>
                            <el-radio v-model="raClass" label="1">
                                可收定金
                            </el-radio>
                        </span>
                        <span>
                            <el-radio v-model="raClass" label="2">
                                只收全费
                            </el-radio>
                        </span>
                    </p>
                    <div class="di">
                        <span>
                            <span>学生插班试听</span>
                            <i class="ico-h">
                             <div class="hint-me">
                                 若学生欠费试听，一个月内没有报名此课程，所欠试听费自动清零
                                <span></span>
                             </div>
                            </i>
                        </span>

                        <span>
                             <el-radio v-model="isCost" label="1">
                               收费
                            </el-radio>
                        </span>
                        <span>
                            <el-radio v-model="isCost" label="2">
                                免费
                            </el-radio>
                        </span>
                    </div>
                    <p>
                        <span>学生特殊优惠</span>
                        <span>
                            <el-radio v-model="stuSealtype" label="1">必须审批</el-radio>
                        </span>
                        <span>
                              <el-radio v-model="stuSealtype" label="2">金额大于校方对普通学生所设定的各项优惠总额，或额外赠送物品或积分，必须审批</el-radio>
                        </span>
                    </p>
                </div>
            </div>
            <div class="detain-class grade-set">
                <div class="sec-top">
                    <span>班级课程 · 扣费 · 设置</span>
                </div>
                <div class="secon">
                    <span><el-radio v-model="classDetain" label="1">未到次数扣费，可不扣费</el-radio> </span>
                    <span><el-radio v-model="classDetain" label="2">未到次数不扣费，补课扣费</el-radio></span>
                    <span><el-radio v-model="classDetain" label="3">每期未到，可顺延 <input type="number" v-model="deNum" min="1" @focus = "taFn ">次，其余扣费，扣费次数补课免费</el-radio></span>
                    <span><el-radio v-model="classDetain" label="4">每期未到 , <input type="number" v-model="taNum" min="1" @focus = "deFn">次内扣费，其余顺延，扣费次数补课免费</el-radio></span>
                </div>
            </div>
            <div class="urgeQuit grade-set">
                <div class="sec-top">
                    <span>班级课程 · 催费 · 退费 · 设置</span>
                </div>
                <div class="cl-input">
                <p>
                    班级课提前 <input type="number" v-model="bringNum" min="1">次，提醒家长续费，学生档案形成“继续”标
                </p>
                <p>
                    班级课开课<input type="number" v-model="goNum" min="1">次后或点名到课超过<input type="number" v-model="mustNum" min="1">次后不可退费
                </p>
                <p>
                    班级课退费额超过<input type="number" v-model="deExceed" min="1">元，或超过本课程实缴总额的<input type="number" v-model="perNum" min="1">%，须审批
                </p>
                </div>
            </div>
            <div class="make-section grade-set">
                <div class="sec-top">
                    <span>班级课程 · 补课 · 设置</span>
                </div>
                <div class="maskSec">
                    <p>
                        学生每期未到次数超过<input type="number" v-model="upLiNum" min="1">次后，不予补课（家长手机端会在请假的时候得到提示）
                    </p>
                    <p>
                        <span>每学期，“未请假”的未到次数</span>
                        <span>
                            <el-radio v-model="isLimiup" label="1">可以补课</el-radio>
                        </span>
                        <span>
                            <el-radio v-model="isLimiup" label="2">不予补课</el-radio>
                        </span>
                    </p>
                </div>
            </div>
            <div class="vipNorm grade-set">
                <div class="sec-top">
                    <span>VIP课程 · 费用标准 · 规则设置</span>
                </div>
                <div class="normList">
                    <p>
                        <span>一对一的费用标准，只设置</span>
                        <span><el-radio v-model="oneNorm" label="1">最低标准值</el-radio></span>
                        <span><el-radio v-model="oneNorm" label="2"> 最高标准值具体签约价，由咨询师根据实情决定，优惠额超过应缴额的 <input type="number" min="1" v-model="oneGon">%,必须审批</el-radio></span>
                    </p>
                    <p>
                        <span>一对N的费用标准， 只设置</span>
                        <span><el-radio v-model="nNorm" label="1">最低标准值</el-radio></span>
                        <span><el-radio v-model="nNorm" label="2">最高标准值具体签约价，由咨询师根据实情决定，优惠额超过应缴额的 <input type="number" min="1" v-model="nGon">%,必须审批</el-radio></span>
                    </p>
                </div>
            </div>
            <div class="vip-count grade-set">
                <div class="sec-top">
                    <span>VIP课时计算 · 设置</span>
                </div>
                <div class="vipCon">
                    <span>VIP课时计算</span>
                    <span><el-radio v-model="vipCount" label="1">精确到个位</el-radio></span>
                    <span><el-radio v-model="vipCount" label="2">精确到小数点后一位</el-radio></span>
                    <span><el-radio v-model="vipCount" label="3">精确到0.5</el-radio></span>
                    <span><el-radio v-model="vipCount" label="4">精确到小数点后两位</el-radio></span>
                    <span><el-radio v-model="vipCount" label="5">精确到0.25</el-radio></span>
                </div>
            </div>
            <div class="vip-urge grade-set">
                <div class="sec-top">
                    <span>VIP课 · 催费提醒 · 设置</span>
                </div>
                <div class="urgeSec">
                    <p>
                        对一课，提前<input type="number" min="1" v-model="urgNum">课时，提醒家长续费，学生档案形成“催续”标
                    </p>
                    <p>
                        对N课，提前<input type="number" min="1" v-model="urgnNum">课时，提醒家长续费，学生档案形成“催续”标
                    </p>
                </div>
            </div>
            <div class="vip-return grade-set">
                <div class="sec-top">
                    <span>VIP课 · 退费审批 · 设置</span>
                </div>
                <div class="sec-rec">
                    <p>对一课退费额超过<input type="number" min="1" v-model="oneMoney">元，或超过本单实缴总额的<input type="number" min="1" v-model="onBaiMoney">%，须审批</p>
                    <p>对N课退费额超过<input type="number" min="1" v-model="nMoney">元，或超过本单实缴总额的<input type="number" min="1" v-model="nBaiMoney">%，须审批</p>
                </div>
            </div>
            <div class="listen-text grade-set">
                <div class="sec-top">
                    <span>对N课程 · 试听费用 · 设置</span>
                </div>
                <div class="lisTen">
                    <p>
                        <span>VIP课</span>
                        <span>
                            <el-radio v-model="liRadio" label="1">插班试听收费</el-radio>
                        </span>
                        <span>
                            <el-radio v-model="liRadio" label="2">插班试听不收费</el-radio>
                        </span>
                    </p>
                    <p>备注：若学生欠费试听，一个月内没有报名此课程，试听费自动清零。</p>
                </div>
            </div>
            <div class="fee_deduction grade-set">
                <div class="sec-top">
                    <span>对N课程 · 扣费 · 设置</span>
                </div>
               <p>
                   <span><el-radio v-model="isFeeRadio" label="1">未到不扣费</el-radio></span>
                   <span><el-radio v-model="isFeeRadio" label="2">未到扣费，补课不扣费</el-radio></span>
               </p>
            </div>
            <div class="upgrade grade-set">
                <div class="sec-top">
                    <span>升级设置</span>
                </div>
                <div class="upgrade-sec">
                    <p>每年    <el-date-picker
                        v-model="value1"
                        type="date"
                        placeholder="选择日期">
                    </el-date-picker>，学生就读年级，自动升级，如不设置本条，系统将会在每年的8月20日，为所有学生自动生年级</p>
                </div>
            </div>
            <div class="sub-bt">
                    <i class ="sel-circle-ok" @click="save"></i>
            </div>
        </div>
    </div>
</template>
<script>
    import ElRadio from "../../../../node_modules/element-ui/packages/radio/src/radio.vue";
    import system  from  '@commonJS/const'
    export default {
        components: {ElRadio},
        data() {
            return {
                raClass : "",//教师端收费
                isCost : "",//费用收取情况
                stuSealtype : "",//学生优惠类型
                classDetain : "",//班级课程选项
                deNum : "",//可延顺次数
                taNum : "",//每期未到，几次内扣费
                bringNum :"",//提前次数
                goNum:"",//开课几次后
                mustNum:"",//超过几次后不可退费
                deExceed:"",//退费超过几次
                perNum:"",//超过百分之多少需要审批
                upLiNum:"",//未到多少次不予补课
                isLimiup:"",//是否可以补课
                oneNorm:"",//一对一费用标准
                oneGon:"",//一对一超额百分数
                nNorm:"",//一对N费用标准
                nGon:"",//一对N超额百分数
                vipCount:"",//VIP课时计算选择
                urgNum:"",//对一课提前几课时提醒
                urgnNum:"",//对N课提前几课时提醒
                oneMoney:"",//对一课超多少元审批
                onBaiMoney:"",//对一课超总额百分之多少审批
                nMoney:"",//对N课超多少元审批
                nBaiMoney:"",//对N课超总额百分之多少审批
                liRadio : "",//对N课试听费用单选
                isFeeRadio :"",//对N课是否扣费
                value1 : "",//升级设置日期
            };
        },
        methods:{
            taFn(){ //聚焦事件
                this.taNum = "";
            },
            deFn(){//聚焦事件
                this.deNum = "";
            },
            save(){
                let teBool = ""; //定金缴费传参数时改变类型  is_allow_earnest
                if(this.raClass == "1"){
                    teBool = true;
                }else if(this.raClass == "2") {
                    teBool = false;
                };
                 let classBool = "";//班级课插班试听是否扣费 is_charge_by_class_transfer_audition
                if(this.isCost == "1"){
                    classBool = true;
                }else if(this.isCost == "2"){
                    classBool = false;
                };
                let stuSealBool = "";//特殊优惠是否审批是否扣费  is_approval_special_discount
                if(this.stuSealtype == "1"){
                    stuSealBool = true;
                }else if(this.stuSealtype == "2"){
                    stuSealBool = false;
                };
                let vipChaaBool = ""; //vip课插班试听是否扣费  is_charge_by_vip_transfer_audition
                if(this.isFeeRadio == "1"){
                    vipChaaBool = true;
                }else if(this.isFeeRadio == "2"){
                    vipChaaBool = false;
                };
                let postponeBoolList = {}; //班级课程 · 扣费 · 设置 向后传参
                if(this.classDetain == "1" || this.classDetain == "2"){
                    postponeBoolList = {
                        name : this.classDetain,
                        postponed_num :"",
                        refund_num : "",
                        is_check : ""
                    }
                }else if(this.classDetain == "3"){
                    postponeBoolList = {
                        name : this.classDetain,
                        postponed_num :this.deNum,
                        refund_num : "",
                        is_check : ""
                    }
                }else if(this.classDetain == "4"){
                    postponeBoolList = {
                        name : this.classDetain,
                        postponed_num :this.taNum,
                        refund_num : "",
                        is_check : ""
                    }
                }
                let buClassBool = ""; //是否可以补课
                if(this.isLimiup == "1"){
                    buClassBool = true;
                }else if(this.isLimiup == "2") {
                    buClassBool = false;
                };
                let minBool = ""; // 1对1是否选择最低标准
                if(this.oneNorm == "1"){
                    minBool = true;
                    this.oneGon = "";
                }else if(this.oneNorm == "2") {
                    minBool = false;
                };
                let oneNbool = "";//1对N是否选择最低标准
                if(this.nNorm == "1"){
                    oneNbool = true;
                    this.nGon = "";
                }else if(this.nNorm == "2") {
                    oneNbool = false;
                };
                let vip_fee_rule = { //vip课程费用规则设置
                    is_check_min_to_1v1 : minBool,
                    v1_discount_max_percent :this.oneGon/100,
                    is_check_min_to_1vN : oneNbool,
                    vn_discount_max_percent : this.nGon/100
                };
                let duiN_is_rule ="";
                if(this.isFeeRadio == "1"){
                    duiN_is_rule = true;
                }else if(this.isFeeRadio == "2") {
                    duiN_is_rule = false;
                };
                let date = new Date(this.value1).getTime();
                console.log(date)
                let headFeeRuleJsonStr = {
                    head_school_id : this.$ls.get("USER_INFO").headSchoolId,
                    is_allow_earnest : teBool,
                    is_charge_by_class_transfer_audition : classBool,
                    is_approval_special_discount : stuSealBool,
                    is_charge_by_vip_transfer_audition : vipChaaBool,
                    course_charge_setting_list : postponeBoolList,
                    class_advance_remind_payment_num : parseInt(this.bringNum),
                    vip_1v1_advance_remind_payment_num :parseInt(this.urgNum),
                    vip_1vn_advance_remind_payment_num : parseInt(this.urgnNum),
                    class_start_num : parseInt(this.goNum),
                    roll_call_num : parseInt(this.mustNum),
                    class_refund_max_money : this.deExceed,
                    class_refund_max_percent : this.perNum/100,
                    vip_1v1_refund_max_money :this.oneMoney,
                    vip_1v1_refund_max_percent : this.onBaiMoney/100,
                    vip_1vn_refund_max_money : this.nMoney,
                    vip_1vn_refund_max_percent :this.nBaiMoney/100,
                    charge_max_num :this.upLiNum,
                    is_compensate :buClassBool,
                    vip_course_fee_rule : vip_fee_rule,
                    is_1vN_miss_not_fee : duiN_is_rule,
                    date : date,
                    vip_class_course_account : this.vipCount,
                    user_id :"",
                    create_time : "",
                    is_delete : "",
                    update_user_id : "",
                    update_time : "",
                    version : "",
//                    accessToken:"aaa"
                }
                let data = {
                    headFeeRuleJsonStr : headFeeRuleJsonStr,
                    accessToken:"aaa"
                }
                this.axios.post(system.integrated+"v1/integrated/feeRule/insertOrUpdateHeadFeeRule",data).then(res => {
                    console.log("999",res)
                }).catch(error => {
                    err(error)
                })
            }
        },
        mounted(){
            let obj = {
                headSchoolId:this.$ls.get("USER_INFO").headSchoolId,
                accessToken:"aaa"
            }
            this.axios.post(system.integrated+"v1/integrated/feeRule/initFeeRule",obj).then(res => {
                console.log("学费",res)
            }).catch(error => {
                err(error)
            })
        }
    };
</script>
